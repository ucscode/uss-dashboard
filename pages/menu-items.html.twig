{% macro createMenuItem(menu) %}

    {% for item in menu.children %}

        {% set itemId = "menu-" ~ item.nodeId %}

        {% set expandable = (item.children|length) and (item.level < 4) %}

        {% set isActive = item.getAttr('active') %}

        {% set isExpanded = isActive or item.getAttr('isExpanded') %}
        
        {% set itemClass = [
            item.level is same as(1) ? "nav-item" : "nav-sub-item",
            expandable ? "nav-item-has-children" : null,
            isActive and not expandable ? "active" : null 
        ] %}
        
        <li class="{{ itemClass[0] }} {{ itemClass[1] }} {{ itemClass[2] }}" data-menu-level='{{ item.level }}'>

            <a href='{{ item.getAttr('href') }}' target='{{ item.getAttr('target') }}'
                {% if expandable %}
                    data-bs-toggle='collapse'
                    data-bs-target='#{{ itemId }}'
                    aria-controls='{{ itemId }}'
                    aria-expanded='{{ isExpanded ? "true" : "false" }}'
                    class="{{ isExpanded ? null : 'collapsed' }}"
                {% endif %}
            >   
                {% if item.level is same as(1) %}
                    <span class='icon'>
                        <i class="{{ item.getAttr('icon') ?? 'bi bi-question-circle' }}"></i>
                    </span>
                {% endif %}
                <span class='text'>{{ item.getAttr('label') }}</span>
            </a>

            {% if expandable %}

                <ul id="{{ itemId }}" class="dropdown-nav collapse {{ isExpanded ? "show" : null }}" 
                    {% if item.level is same as(1) %}
                        data-bs-parent="#nav-group"
                    {% endif %}
                >
                    {{ _self.createMenuItem(item) }}
                </ul>

            {% endif %}

        </li>

    {% endfor %}

{% endmacro %}


{{ _self.createMenuItem(Udash.menu) }}

<li class="nav-item nav-item-has-children d-none" data-menu-level="0">
    <a href="javascript:void(0)" class="" data-bs-toggle="collapse" data-bs-target="#menufy-shipnew" aria-controls="menufy-shipnew" aria-expanded="true">
    <span class="icon"><i class="bi bi-send-plus"></i></span>
    <span class="text">New Shipment</span>
    </a>
    <ul id="menufy-shipnew" class="dropdown-nav collapse show" data-bs-parent="#nav-group" style="">

        <li class="nav-sub-item nav-item-has-children" data-menu-level="1">

            <a href="javascript:void(0)" class="" data-bs-toggle="collapse" data-bs-target="#menufy1-trial" aria-controls="menufy1-trial" aria-expanded="true">
            <span class="text">Ship Child</span>
            </a>

            <ul id="menufy1-trial" class="dropdown-nav collapse show" style="">

                <li class="nav-sub-item nav-item-has-children" data-menu-level="2">

                    <a href="javascript:void(0)" class="collapsed" data-bs-toggle="collapse" data-bs-target="#menufy2-prone" aria-controls="menufy2-prone" aria-expanded="false">
                    <span class="text">Ghost</span>
                    </a>

                    <ul id="menufy2-prone" class="dropdown-nav collapse" style="">

                        <li class="nav-sub-item" data-menu-level="3">
                            <a href="https://bruce.lee" target="_self">
                            <span class="text">Fist Of Fury</span>
                            </a>
                        </li>

                        <li class="nav-sub-item" data-menu-level="3">
                            <a href="javascript:void(0)" target="_self">
                            <span class="text">True Waking Child</span>
                            </a>
                            <ul id="menufy3-milk" class="collapse dropdown-nav ">
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li class="nav-sub-item" data-menu-level="1">
            <a href="http://works" target="_self">
            <span class="text">Ship Child</span>
            </a>
        </li>
    </ul>
</li>